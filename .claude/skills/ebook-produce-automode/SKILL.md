---
name: ebook-produce-automode
description: 完全自動モード。テーマ調査から原稿完成・PR作成まで質問ゼロで全自動実行
argument-hint: "[Money|Health|Ambition|Relation|book-slug]"
---

# /ebook-produce-automode — 完全自動モード

`/ebook-produce` と同一の制作パイプラインを、**ユーザーへの質問ゼロ**で全自動実行する。
テーマ発見・企画・初期化・執筆・レビュー・結合・PR作成まで一切の対話なしで完結する。

引数パターン：
- `/ebook-produce-automode` — 全HARMカテゴリでテーマ調査し、最高スコアのテーマで自動制作
- `/ebook-produce-automode Money` — 指定HARMカテゴリでテーマ調査し、最高スコアのテーマで自動制作
- `/ebook-produce-automode {slug}` — 企画済み書籍の全工程を自動実行（`/ebook-produce {slug}` と同等）

## `/ebook-produce` との違い

| ポイント | `/ebook-produce` | `/ebook-produce-automode` |
|---------|------------------|---------------------------|
| テーマ決定 | ユーザーに「テーマは決まっていますか？」と質問 | 常にテーマ調査を自動実行 |
| HARMカテゴリ | ユーザーが選択 | 引数指定 or 全カテゴリ自動 |
| 著者背景・除外テーマ | ユーザーに質問 | `.env` から自動読み込み |
| テーマ候補選択 | 5候補からユーザーが選択 | 最高スコア（第1位）を自動選択 |
| 著者名・文体 | ユーザーに質問 | `.env` から自動読み込み |
| 章数・文字数 | ユーザーに質問 | デフォルト値（8章・20,000文字）を自動適用 |
| タイトル案選択 | 3案からユーザーが選択 | 最高スコアのタイトル案を自動選択 |
| BDF・バックエンド確認 | ユーザーに提示して確認 | 自動承認（テーマ調査結果をそのまま採用） |
| 次アクション選択 | ユーザーが選択 | 常に全工程一括実行 |

## 前提条件

`.env` ファイルに以下が設定されていること。未設定の場合はエラーとして停止する：

| 環境変数 | 必須 | 用途 |
|---------|------|------|
| `AUTHOR_NAME` | **必須** | 著者名 |
| `DEFAULT_TONE` | **必須** | 文体（です・ます / だ・である） |
| `WRITING_STYLE` | **必須** | 文章の雰囲気・トーン |
| `AUTHOR_BACKGROUND` | **必須** | 著者バックグラウンド |
| `EXCLUDED_TOPICS` | 任意 | 除外テーマ（空欄可） |

---

## 工程-1A: テーマ発見（自動）

**この工程は引数がHARMカテゴリまたは引数なしの場合のみ実行する。**
**引数が既存書籍スラッグの場合はスキップし、工程0に直接進む。**

### 手順

1. `.env` を読み込み、必須変数が全て設定されていることを確認する。未設定があればエラーメッセージを出して停止する。

2. HARMカテゴリを決定する：
   - 引数あり（Money/Health/Ambition/Relation）→ そのカテゴリで調査
   - 引数なし → 全カテゴリで調査（`--auto` 相当）

3. `/ebook-idea` と同じ Phase 2（3並列リサーチャー）を実行する：
   - `TeamCreate(team_name="ebook-idea-research")` でチームを作成
   - `trend-researcher`、`competitor-researcher`、`needs-researcher` を並列起動
   - 入力値は全て `.env` から自動取得：
     - `AUTHOR_BACKGROUND` → 著者バックグラウンド
     - `EXCLUDED_TOPICS` → 除外テーマ
   - 読者層ヒントは空欄（自動モードのため）

4. `/ebook-idea` と同じ Phase 3（テーマ評価・スコアリング）を実行する：
   - リサーチャー3名の完了後、`theme-evaluator` を起動
   - 5つのテーマ候補を生成・スコアリング

5. **第1位（最高スコア）のテーマを自動選択する**（ユーザーに質問しない）

6. チームをクリーンアップする：
   - 全リサーチャー + `theme-evaluator` をシャットダウン
   - `TeamDelete("ebook-idea-research")` でチーム削除

7. テーマ候補レポートをユーザーに表示する（情報提供のみ、確認は求めない）：
```
============================================
[自動選択] Kindle書籍テーマ候補レポート
============================================

【自動選択 → 第1位】総合スコア: {score}/70
仮タイトル: {provisional_title}
コンセプト: {concept}
ニッチ公式: {target} × {benefit} × {method}

（第2位〜第5位も参考として表示）

→ 第1位を採用して制作を開始します
============================================
```

---

## 工程-1B: プロジェクト初期化（自動）

**テーマ調査結果と `.env` の値を使い、全項目を自動入力する。**

### 自動決定される値

| 項目 | データソース |
|------|------------|
| 書籍タイトル | テーマ候補 第1位の `provisional_title` |
| 著者名 | `.env` の `AUTHOR_NAME` |
| ジャンル | テーマ候補の `harm_category` から推定 |
| 想定読者 | テーマ候補の `niche_formula.target` |
| 書籍の概要 | テーマ候補の `concept` + `reasoning` |
| 文体 | `.env` の `DEFAULT_TONE` |
| 目標章数 | **8章**（デフォルト固定） |
| 目標文字数 | **20,000文字**（デフォルト固定） |
| HARM分類 | テーマ候補の `harm_category` |
| ニッチターゲット | テーマ候補の `niche_formula` |
| BDF分析 | テーマ候補の `bdf` |
| 差別化要素 | テーマ候補の `differentiation` |
| キーワード | テーマ候補の `keywords` |
| バックエンド導線 | テーマ候補の `backend_idea` |
| 構成タイプ | テーマ候補の `structure_type` |

### 手順

1. タイトルから英数ケバブケースのスラッグを生成する

2. **Gitブランチを作成する**：
   ```bash
   git checkout main
   git pull origin main
   git checkout -b feature/{slug}
   ```

3. ディレクトリとファイルを作成する：
   ```
   books/{slug}/
   ├── book.yaml
   ├── chapters/
   │   ├── 00-introduction.md
   │   └── 99-afterword.md
   ├── assets/
   └── reviews/
   ```

4. book.yaml を作成する（テーマ調査結果 + `.env` の値で全フィールドを埋める）

5. **戦略設計SubAgentは起動しない**（テーマ調査で完了済みのため）

6. **初期コミット**：
   ```bash
   git add books/{slug}/
   git commit -m "[{slug}] init: プロジェクト初期化"
   ```

**→ 企画完了。以降は `/ebook-produce` の工程0〜工程7と完全に同一の処理を実行する。**

---

## 工程0〜工程7: 制作パイプライン

以下は `/ebook-produce` のSKILL.mdと**完全に同一**の処理を実行する。
詳細は `/ebook-produce` のSKILL.mdを参照すること。

### 工程0: チーム作成
`TeamCreate(team_name="ebook-{slug}")` でチームを作成する。

### 工程1: アウトライン作成
- `structure-writer` + `editor-in-chief` を並列起動
- タスク依存関係で順序制御
- 完了後 `structure-writer` をシャットダウン
- コミット: `[{slug}] outline: アウトライン作成`

### 工程2: 全章執筆
- 全章の `writer-ch{NN}` を並列起動
- 編集長への質問は SendMessage で可能
- 完了後全ライターをシャットダウン
- コミット: `[{slug}] write: 全章執筆完了`

### 工程3: 全章レビュー
- `proofreader` + `content-editor` を並列起動
- 校正・校閲完了後、`editor-in-chief` に統合レビューを依頼
- 完了後 `proofreader` + `content-editor` をシャットダウン
- コミット: `[{slug}] review: 全章レビュー完了`

### 工程4: 原稿結合
- `finalizer` を起動
- 全章を結合し manuscript.md を生成
- コミット: `[{slug}] build: 原稿結合完了`

### 工程5: チームクリーンアップ
- `finalizer` + `editor-in-chief` をシャットダウン
- `TeamDelete()` でチームリソースを削除

### 工程6: プルリクエスト作成
- 全章の `reviewed_by` に `editor_in_chief` が含まれることを確認
- `git push -u origin feature/{slug}`
- `gh pr create` でPR作成

### 工程7: 最終レポート
```
===================================
[自動モード] 制作完了レポート: {書籍タイトル}
===================================

総章数: {N}章
総文字数: {X}文字 / 目標 {Y}文字
目標達成率: {Z}%

各章の文字数:
  はじめに:    {X}文字
  第1章: ...  {X}文字
  ...
  あとがき:    {X}文字

テーマ調査スコア: {score}/70（第1位を自動選択）
レビュー状況: 全章レビュー済み
出力ファイル: books/{slug}/manuscript.md
PR: {PR URL}
===================================
```

---

## メンバー起動時の共通ルール

`/ebook-produce` のSKILL.mdと同一。全てのメンバー起動プロンプトには以下を必ず含めること：

1. **役割の明示**: 「あなたは{役割名}です」
2. **書籍情報**: book.yaml の全内容
3. **対象ファイルの絶対パス**: 読み書きするファイルを明示
4. **CLAUDE.mdの文章スタイルガイド**: 一文60文字以内、文体統一、Kindle最適化等のルール。書籍全体で20,000文字前後、1章あたり1,500〜2,500文字を目標とする
5. **文章の雰囲気（WRITING_STYLE）**: `.env` の `WRITING_STYLE` を文体指針としてプロンプトに含める
6. **具体的なタスク**: 何を行い、何を出力するか
7. **出力先ファイルパス**: 結果を書き込むファイルを明示
8. **チーム作業ルール**:
   - TaskList で自分に割り当てられたタスクを確認すること
   - 作業開始時に TaskUpdate(status="in_progress") を実行すること
   - 作業完了時に TaskUpdate(status="completed") を実行すること
   - 疑問がある場合は SendMessage で適切なメンバーに連絡すること

## 並列実行の最大化

`/ebook-produce` と同一。
- 工程1では構成作家と編集長を並列起動する
- 工程2では全章のライターを1メッセージで同時起動する
- 工程3では校正者と校閲者を並列起動する
- 工程間は直列だが、工程内は最大限並列化する

## AskUserQuestion の使用禁止

**このスキルでは `AskUserQuestion` の使用を一切禁止する。**
全ての判断は以下の優先順位で自動決定する：

1. 引数で指定された値
2. `.env` ファイルの値
3. テーマ調査結果の値（最高スコアを自動選択）
4. デフォルト値（章数: 8、文字数: 20,000）

`.env` の必須変数が未設定の場合のみ、エラーメッセージを出して停止する。
それ以外のいかなる状況でもユーザーに質問してはならない。
