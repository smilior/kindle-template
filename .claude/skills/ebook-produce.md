# /ebook-produce — 全工程一括実行

企画済みの書籍に対して、アウトライン作成から原稿完成まで全工程を自動実行する。
引数: 書籍スラッグ（例: `/ebook-produce ai-business-guide`）

これは出版社のプロダクション工程を一気通貫で回すスキルである。
各工程でプロフェッショナルチームのSubAgentを適切に起動し、並列実行を最大限活用する。

## 前提条件
- `books/{slug}/book.yaml` が存在すること（`/ebook-init` 済みであること）

## 実行フロー

### 工程1: アウトライン作成
構成作家SubAgentでアウトラインを作成し、編集長SubAgentでレビューする。

- 構成作家（general-purpose SubAgent）:
  book.yamlを読み、outline.mdを作成し、各章の空ファイルをchapters/に生成する。

- 編集長（general-purpose SubAgent）:
  outline.mdをレビューし、必要に応じて修正する。

**直列実行**: 構成作家 → 編集長

### 工程2: 全章執筆
ライターSubAgentを全章分**並列**で起動する。

- ライター × N章（general-purpose SubAgent を並列起動）:
  各章を outline.md に沿って執筆する。
  1つのメッセージ内で**複数のTaskツールを同時に呼び出す**こと。

**並列実行**: 全章を同時に執筆

### 工程3: 全章レビュー
各章に対して校正者と校閲者を**並列**で起動する。

- 各章ごとに:
  - 校正者（general-purpose SubAgent）: 誤字脱字・文法・表記ゆれを修正
  - 校閲者（general-purpose SubAgent）: 内容の正確性・論理性をレビュー

  校正者と校閲者は**同一章に対して並列で起動**する。
  複数章のレビューも**同時に並列起動**する。

- 全レビュー完了後、各章に対して:
  - 編集長（general-purpose SubAgent）: 校正結果と校閲レポートを統合し、最終修正を適用

**並列実行**: 校正者 + 校閲者（各章並列） → 編集長（各章直列可）

### 工程4: 原稿結合
仕上げ担当SubAgentで全章を結合し、manuscript.md を生成する。

- 仕上げ担当（general-purpose SubAgent）:
  全章を結合し、目次・奥付を自動生成する。

**直列実行**: 仕上げ担当

### 工程5: 最終レポート
全工程完了後、以下を報告する：

```
===================================
制作完了レポート: {書籍タイトル}
===================================

総章数: {N}章
総文字数: {X}文字 / 目標 {Y}文字
目標達成率: {Z}%

各章の文字数:
  はじめに:    {X}文字
  第1章: ...  {X}文字
  第2章: ...  {X}文字
  ...
  あとがき:    {X}文字

レビュー状況: 全章レビュー済み
出力ファイル: books/{slug}/manuscript.md
===================================
```

## SubAgent起動時の共通ルール

全てのSubAgent起動プロンプトには以下を必ず含めること：

1. **役割の明示**: 「あなたは{役割名}です」
2. **書籍情報**: book.yaml の全内容
3. **対象ファイルの絶対パス**: 読み書きするファイルを明示
4. **CLAUDE.mdの文章スタイルガイド**: 一文60文字以内、文体統一、Kindle最適化等のルール
5. **具体的なタスク**: 何を行い、何を出力するか
6. **出力先ファイルパス**: 結果を書き込むファイルを明示

## 並列実行の最大化

このスキルの最大の特徴は並列実行の徹底である：

- 工程2では全章のライターを1メッセージで同時起動する
- 工程3では「章の数 × 2」のSubAgentを可能な限り同時起動する
  - 例: 10章の本なら、校正者10 + 校閲者10 = 最大20のSubAgentを並列起動
- 工程間（1→2→3→4）は直列だが、工程内は最大限並列化する
