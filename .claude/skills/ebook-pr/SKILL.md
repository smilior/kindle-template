---
name: ebook-pr
description: プルリクエスト作成。レビュー済みチェック付き
argument-hint: "<book-slug>"
---

# /ebook-pr — プルリクエスト作成

原稿完成後にプルリクエストを作成する。
引数: 書籍スラッグ（例: `/ebook-pr ai-business-guide`）

## 前提条件チェック（必須）

PR作成前に以下を**すべて**検証する。1つでも満たさない場合はPRを作成せず、エラーを報告する。

### 1. ブランチ確認
- 現在のブランチが `feature/{slug}` であることを確認する
- 異なる場合はチェックアウトする

### 2. レビュー完了チェック（最重要）
- `books/{slug}/chapters/` 内の全章ファイルのフロントマターを読み込む
- **全章の `reviewed_by` に `editor_in_chief` が含まれていること**を確認する
- 未レビューの章がある場合は以下を表示してPR作成を中止する：
  ```
  PR作成を中止しました。以下の章がレビュー未完了です：
  - 第X章: {タイトル}（reviewed_by: {現在の値}）
  - 第Y章: {タイトル}（reviewed_by: {現在の値}）

  先に /ebook-review {slug} を実行してください。
  ```

### 3. 原稿結合チェック
- `books/{slug}/manuscript.md` が存在することを確認する
- 存在しない場合は `/ebook-build {slug}` の実行を案内する

### 4. コミット漏れチェック
- `git status` で未コミットの変更がないことを確認する
- 未コミットの変更がある場合は自動でコミットする

## PR作成手順

全チェックを通過した場合のみ、以下を実行する。

1. **リモートにプッシュする**：
   ```bash
   git push -u origin feature/{slug}
   ```

2. **制作完了レポートを生成する**：
   - 全章の文字数を集計
   - book.yaml の word_count_target との差分を算出
   - レビュー状況を一覧化

3. **PRを作成する**（gh コマンドを使用）：
   ```bash
   gh pr create \
     --base main \
     --head feature/{slug} \
     --title "{書籍タイトル} — 原稿完成" \
     --body "$(cat <<'EOF'
   ## 制作完了レポート

   ### 書籍情報
   - タイトル: {書籍タイトル}
   - 著者: {著者名}
   - ジャンル: {ジャンル}

   ### 統計
   - 総章数: {N}章
   - 総文字数: {X}文字 / 目標 {Y}文字（達成率 {Z}%）

   ### 各章の文字数
   | 章 | タイトル | 文字数 | レビュー |
   |----|---------|--------|---------|
   | はじめに | ... | X文字 | 完了 |
   | 第1章 | ... | X文字 | 完了 |
   | ... | ... | ... | ... |

   ### レビュー状況
   全章レビュー済み（校正者・校閲者・編集長）

   EOF
   )"
   ```

4. **PR URLをユーザーに報告する**
